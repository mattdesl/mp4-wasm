var Er=(()=>{var g=import.meta.url;return function(t){t=t||{};var t=typeof t!="undefined"?t:{},u,h;t.ready=new Promise(function(r,n){u=r,h=n}),t.create_buffer=function(n){return t._malloc(n)},t.free_buffer=function(n){return t._free(n)},t.locateFile=function(n,e){return t.simd&&(n=n.replace(/\.wasm$/i,".simd.wasm")),t.getWasmPath?t.getWasmPath(n,e,t.simd):e+n},t.createWebCodecsEncoder=function(n){return $r(t,n)};var y=Object.assign({},t),v=[],_="./this.program",N=(r,n)=>{throw n},D=typeof window=="object",H=typeof importScripts=="function",or=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",A="";function L(r){return t.locateFile?t.locateFile(r,A):A+r}var I,q,$,nr;(D||H)&&(H?A=self.location.href:typeof document!="undefined"&&document.currentScript&&(A=document.currentScript.src),g&&(A=g),A.indexOf("blob:")!==0?A=A.substr(0,A.replace(/[?#].*/,"").lastIndexOf("/")+1):A="",I=r=>{var n=new XMLHttpRequest;return n.open("GET",r,!1),n.send(null),n.responseText},H&&($=r=>{var n=new XMLHttpRequest;return n.open("GET",r,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)}),q=(r,n,e)=>{var i=new XMLHttpRequest;i.open("GET",r,!0),i.responseType="arraybuffer",i.onload=()=>{if(i.status==200||i.status==0&&i.response){n(i.response);return}e()},i.onerror=e,i.send(null)},nr=r=>document.title=r);var lr=t.print||console.log.bind(console),z=t.printErr||console.warn.bind(console);Object.assign(t,y),y=null,t.arguments&&(v=t.arguments),t.thisProgram&&(_=t.thisProgram),t.quit&&(N=t.quit);var K=4,P;t.wasmBinary&&(P=t.wasmBinary);var Ur=t.noExitRuntime||!0;typeof WebAssembly!="object"&&ir("no native wasm support detected");var J,fr=!1,w;function m(r,n,e){for(var i=n+e,a="";!(n>=i);){var o=r[n++];if(!o)return a;if(!(o&128)){a+=String.fromCharCode(o);continue}var c=r[n++]&63;if((o&224)==192){a+=String.fromCharCode((o&31)<<6|c);continue}var f=r[n++]&63;if((o&240)==224?o=(o&15)<<12|c<<6|f:o=(o&7)<<18|c<<12|f<<6|r[n++]&63,o<65536)a+=String.fromCharCode(o);else{var s=o-65536;a+=String.fromCharCode(55296|s>>10,56320|s&1023)}}return a}function T(r,n){return r?m(W,r,n):""}function F(r,n,e,i){if(!(i>0))return 0;for(var a=e,o=e+i-1,c=0;c<r.length;++c){var f=r.charCodeAt(c);if(f>=55296&&f<=57343){var s=r.charCodeAt(++c);f=65536+((f&1023)<<10)|s&1023}if(f<=127){if(e>=o)break;n[e++]=f}else if(f<=2047){if(e+1>=o)break;n[e++]=192|f>>6,n[e++]=128|f&63}else if(f<=65535){if(e+2>=o)break;n[e++]=224|f>>12,n[e++]=128|f>>6&63,n[e++]=128|f&63}else{if(e+3>=o)break;n[e++]=240|f>>18,n[e++]=128|f>>12&63,n[e++]=128|f>>6&63,n[e++]=128|f&63}}return n[e]=0,e-a}function C(r,n,e){return F(r,W,n,e)}function E(r){for(var n=0,e=0;e<r.length;++e){var i=r.charCodeAt(e);i<=127?n++:i<=2047?n+=2:i>=55296&&i<=57343?(n+=4,++e):n+=3}return n}var er,vr,W,Q,pr,X,O,Rr,Pr;function Wr(r){er=r,t.HEAP8=vr=new Int8Array(r),t.HEAP16=Q=new Int16Array(r),t.HEAP32=X=new Int32Array(r),t.HEAPU8=W=new Uint8Array(r),t.HEAPU16=pr=new Uint16Array(r),t.HEAPU32=O=new Uint32Array(r),t.HEAPF32=Rr=new Float32Array(r),t.HEAPF64=Pr=new Float64Array(r)}var me=t.INITIAL_MEMORY||16777216,kr,Sr=[],Ir=[],Or=[],Kr=!1;function Jr(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)rn(t.preRun.shift());gr(Sr)}function Qr(){Kr=!0,gr(Ir)}function Mr(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)en(t.postRun.shift());gr(Or)}function rn(r){Sr.unshift(r)}function nn(r){Ir.unshift(r)}function en(r){Or.unshift(r)}var G=0,hr=null,tr=null;function tn(r){G++,t.monitorRunDependencies&&t.monitorRunDependencies(G)}function an(r){if(G--,t.monitorRunDependencies&&t.monitorRunDependencies(G),G==0&&(hr!==null&&(clearInterval(hr),hr=null),tr)){var n=tr;tr=null,n()}}function ir(r){t.onAbort&&t.onAbort(r),r="Aborted("+r+")",z(r),fr=!0,w=1,r+=". Build with -sASSERTIONS for more info.";var n=new WebAssembly.RuntimeError(r);throw h(n),n}var on="data:application/octet-stream;base64,";function Vr(r){return r.startsWith(on)}var k;t.locateFile?(k="mp4.wasm",Vr(k)||(k=L(k))):k=new URL("mp4.wasm",import.meta.url).toString();function Hr(r){try{if(r==k&&P)return new Uint8Array(P);if($)return $(r);throw"both async and sync fetching of the wasm failed"}catch(n){ir(n)}}function fn(){return!P&&(D||H)&&typeof fetch=="function"?fetch(k,{credentials:"same-origin"}).then(function(r){if(!r.ok)throw"failed to load wasm binary file at '"+k+"'";return r.arrayBuffer()}).catch(function(){return Hr(k)}):Promise.resolve().then(function(){return Hr(k)})}function sn(){var r={a:se};function n(c,f){var s=c.exports;t.asm=s,J=t.asm.x,Wr(J.buffer),kr=t.asm.B,nn(t.asm.y),an("wasm-instantiate")}tn("wasm-instantiate");function e(c){n(c.instance)}function i(c){return fn().then(function(f){return WebAssembly.instantiate(f,r)}).then(function(f){return f}).then(c,function(f){z("failed to asynchronously prepare wasm: "+f),ir(f)})}function a(){return!P&&typeof WebAssembly.instantiateStreaming=="function"&&!Vr(k)&&typeof fetch=="function"?fetch(k,{credentials:"same-origin"}).then(function(c){var f=WebAssembly.instantiateStreaming(c,r);return f.then(e,function(s){return z("wasm streaming compile failed: "+s),z("falling back to ArrayBuffer instantiation"),i(e)})}):i(e)}if(t.instantiateWasm)try{var o=t.instantiateWasm(r,n);return o}catch(c){z("Module.instantiateWasm callback failed with error: "+c),h(c)}return a().catch(h),{}}function gr(r){for(;r.length>0;)r.shift()(t)}function cn(r,n,e,i){ir("Assertion failed: "+T(r)+", at: "+[n?T(n):"unknown filename",e,i?T(i):"unknown function"])}function un(r,n,e,i,a){}function _r(r){switch(r){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+r)}}function ln(){for(var r=new Array(256),n=0;n<256;++n)r[n]=String.fromCharCode(n);Dr=r}var Dr=void 0;function S(r){for(var n="",e=r;W[e];)n+=Dr[W[e++]];return n}var M={},Y={},sr={},vn=48,pn=57;function Lr(r){if(r===void 0)return"_unknown";r=r.replace(/[^a-zA-Z0-9_]/g,"$");var n=r.charCodeAt(0);return n>=vn&&n<=pn?"_"+r:r}function jr(r,n){return r=Lr(r),new Function("body","return function "+r+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(n)}function dr(r,n){var e=jr(n,function(i){this.name=n,this.message=i;var a=new Error(i).stack;a!==void 0&&(this.stack=this.toString()+`
`+a.replace(/^Error(:[^\n]*)?\n/,""))});return e.prototype=Object.create(r.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},e}var Br=void 0;function U(r){throw new Br(r)}var Nr=void 0;function xr(r){throw new Nr(r)}function hn(r,n,e){r.forEach(function(f){sr[f]=n});function i(f){var s=e(f);s.length!==r.length&&xr("Mismatched type converter count");for(var l=0;l<r.length;++l)j(r[l],s[l])}var a=new Array(n.length),o=[],c=0;n.forEach((f,s)=>{Y.hasOwnProperty(f)?a[s]=Y[f]:(o.push(f),M.hasOwnProperty(f)||(M[f]=[]),M[f].push(()=>{a[s]=Y[f],++c,c===o.length&&i(a)}))}),o.length===0&&i(a)}function j(r,n,e={}){if(!("argPackAdvance"in n))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=n.name;if(r||U('type "'+i+'" must have a positive integer typeid pointer'),Y.hasOwnProperty(r)){if(e.ignoreDuplicateRegistrations)return;U("Cannot register type '"+i+"' twice")}if(Y[r]=n,delete sr[r],M.hasOwnProperty(r)){var a=M[r];delete M[r],a.forEach(o=>o())}}function gn(r,n,e,i,a){var o=_r(e);n=S(n),j(r,{name:n,fromWireType:function(c){return!!c},toWireType:function(c,f){return f?i:a},argPackAdvance:8,readValueFromPointer:function(c){var f;if(e===1)f=vr;else if(e===2)f=Q;else if(e===4)f=X;else throw new TypeError("Unknown boolean type size: "+n);return this.fromWireType(f[c>>o])},destructorFunction:null})}var mr=[],V=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function yr(r){r>4&&--V[r].refcount==0&&(V[r]=void 0,mr.push(r))}function _n(){for(var r=0,n=5;n<V.length;++n)V[n]!==void 0&&++r;return r}function dn(){for(var r=5;r<V.length;++r)if(V[r]!==void 0)return V[r];return null}function mn(){t.count_emval_handles=_n,t.get_first_emval=dn}var R={toValue:r=>(r||U("Cannot use deleted val. handle = "+r),V[r].value),toHandle:r=>{switch(r){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var n=mr.length?mr.pop():V.length;return V[n]={refcount:1,value:r},n}}}};function wr(r){return this.fromWireType(X[r>>2])}function yn(r,n){n=S(n),j(r,{name:n,fromWireType:function(e){var i=R.toValue(e);return yr(e),i},toWireType:function(e,i){return R.toHandle(i)},argPackAdvance:8,readValueFromPointer:wr,destructorFunction:null})}function wn(r,n){switch(n){case 2:return function(e){return this.fromWireType(Rr[e>>2])};case 3:return function(e){return this.fromWireType(Pr[e>>3])};default:throw new TypeError("Unknown float type: "+r)}}function bn(r,n,e){var i=_r(e);n=S(n),j(r,{name:n,fromWireType:function(a){return a},toWireType:function(a,o){return o},argPackAdvance:8,readValueFromPointer:wn(n,i),destructorFunction:null})}function An(r,n){if(!(r instanceof Function))throw new TypeError("new_ called with constructor type "+typeof r+" which is not a function");var e=jr(r.name||"unknownFunctionName",function(){});e.prototype=r.prototype;var i=new e,a=r.apply(i,n);return a instanceof Object?a:i}function qr(r){for(;r.length;){var n=r.pop(),e=r.pop();e(n)}}function En(r,n,e,i,a){var o=n.length;o<2&&U("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var c=n[1]!==null&&e!==null,f=!1,s=1;s<n.length;++s)if(n[s]!==null&&n[s].destructorFunction===void 0){f=!0;break}for(var l=n[0].name!=="void",b="",p="",s=0;s<o-2;++s)b+=(s!==0?", ":"")+"arg"+s,p+=(s!==0?", ":"")+"arg"+s+"Wired";var d="return function "+Lr(r)+"("+b+`) {
if (arguments.length !== `+(o-2)+`) {
throwBindingError('function `+r+" called with ' + arguments.length + ' arguments, expected "+(o-2)+` args!');
}
`;f&&(d+=`var destructors = [];
`);var Z=f?"destructors":"null",x=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],ar=[U,i,a,qr,n[0],n[1]];c&&(d+="var thisWired = classParam.toWireType("+Z+`, this);
`);for(var s=0;s<o-2;++s)d+="var arg"+s+"Wired = argType"+s+".toWireType("+Z+", arg"+s+"); // "+n[s+2].name+`
`,x.push("argType"+s),ar.push(n[s+2]);if(c&&(p="thisWired"+(p.length>0?", ":"")+p),d+=(l?"var rv = ":"")+"invoker(fn"+(p.length>0?", ":"")+p+`);
`,f)d+=`runDestructors(destructors);
`;else for(var s=c?1:2;s<n.length;++s){var rr=s===1?"thisWired":"arg"+(s-2)+"Wired";n[s].destructorFunction!==null&&(d+=rr+"_dtor("+rr+"); // "+n[s].name+`
`,x.push(rr+"_dtor"),ar.push(n[s].destructorFunction))}l&&(d+=`var ret = retType.fromWireType(rv);
return ret;
`),d+=`}
`,x.push(d);var ve=An(Function,x).apply(null,ar);return ve}function Tn(r,n,e){if(r[n].overloadTable===void 0){var i=r[n];r[n]=function(){return r[n].overloadTable.hasOwnProperty(arguments.length)||U("Function '"+e+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+r[n].overloadTable+")!"),r[n].overloadTable[arguments.length].apply(this,arguments)},r[n].overloadTable=[],r[n].overloadTable[i.argCount]=i}}function Fn(r,n,e){t.hasOwnProperty(r)?((e===void 0||t[r].overloadTable!==void 0&&t[r].overloadTable[e]!==void 0)&&U("Cannot register public name '"+r+"' twice"),Tn(t,r,r),t.hasOwnProperty(e)&&U("Cannot register multiple overloads of a function with the same number of arguments ("+e+")!"),t[r].overloadTable[e]=n):(t[r]=n,e!==void 0&&(t[r].numArguments=e))}function Cn(r,n){for(var e=[],i=0;i<r;i++)e.push(O[n+i*4>>2]);return e}function Un(r,n,e){t.hasOwnProperty(r)||xr("Replacing nonexistant public symbol"),t[r].overloadTable!==void 0&&e!==void 0?t[r].overloadTable[e]=n:(t[r]=n,t[r].argCount=e)}function Rn(r,n,e){var i=t["dynCall_"+r];return e&&e.length?i.apply(null,[n].concat(e)):i.call(null,n)}var cr=[];function zr(r){var n=cr[r];return n||(r>=cr.length&&(cr.length=r+1),cr[r]=n=kr.get(r)),n}function Pn(r,n,e){if(r.includes("j"))return Rn(r,n,e);var i=zr(n).apply(null,e);return i}function Wn(r,n){var e=[];return function(){return e.length=0,Object.assign(e,arguments),Pn(r,n,e)}}function kn(r,n){r=S(r);function e(){return r.includes("j")?Wn(r,n):zr(n)}var i=e();return typeof i!="function"&&U("unknown function pointer with signature "+r+": "+n),i}var Xr=void 0;function Gr(r){var n=Yr(r),e=S(n);return B(n),e}function Sn(r,n){var e=[],i={};function a(o){if(!i[o]&&!Y[o]){if(sr[o]){sr[o].forEach(a);return}e.push(o),i[o]=!0}}throw n.forEach(a),new Xr(r+": "+e.map(Gr).join([", "]))}function In(r,n,e,i,a,o){var c=Cn(n,e);r=S(r),a=kn(i,a),Fn(r,function(){Sn("Cannot call "+r+" due to unbound types",c)},n-1),hn([],c,function(f){var s=[f[0],null].concat(f.slice(1));return Un(r,En(r,s,null,a,o),n-1),[]})}function On(r,n,e){switch(n){case 0:return e?function(a){return vr[a]}:function(a){return W[a]};case 1:return e?function(a){return Q[a>>1]}:function(a){return pr[a>>1]};case 2:return e?function(a){return X[a>>2]}:function(a){return O[a>>2]};default:throw new TypeError("Unknown integer type: "+r)}}function Vn(r,n,e,i,a){n=S(n),a===-1&&(a=4294967295);var o=_r(e),c=p=>p;if(i===0){var f=32-8*e;c=p=>p<<f>>>f}var s=n.includes("unsigned"),l=(p,d)=>{},b;s?b=function(p,d){return l(d,this.name),d>>>0}:b=function(p,d){return l(d,this.name),d},j(r,{name:n,fromWireType:c,toWireType:b,argPackAdvance:8,readValueFromPointer:On(n,o,i!==0),destructorFunction:null})}function Hn(r,n,e){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],a=i[n];function o(c){c=c>>2;var f=O,s=f[c],l=f[c+1];return new a(er,l,s)}e=S(e),j(r,{name:e,fromWireType:o,argPackAdvance:8,readValueFromPointer:o},{ignoreDuplicateRegistrations:!0})}function Dn(r,n){n=S(n);var e=n==="std::string";j(r,{name:n,fromWireType:function(i){var a=O[i>>2],o=i+4,c;if(e)for(var f=o,s=0;s<=a;++s){var l=o+s;if(s==a||W[l]==0){var b=l-f,p=T(f,b);c===void 0?c=p:(c+=String.fromCharCode(0),c+=p),f=l+1}}else{for(var d=new Array(a),s=0;s<a;++s)d[s]=String.fromCharCode(W[o+s]);c=d.join("")}return B(i),c},toWireType:function(i,a){a instanceof ArrayBuffer&&(a=new Uint8Array(a));var o,c=typeof a=="string";c||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Int8Array||U("Cannot pass non-string to std::string"),e&&c?o=E(a):o=a.length;var f=Ar(4+o+1),s=f+4;if(O[f>>2]=o,e&&c)C(a,s,o+1);else if(c)for(var l=0;l<o;++l){var b=a.charCodeAt(l);b>255&&(B(s),U("String has UTF-16 code units that do not fit in 8 bits")),W[s+l]=b}else for(var l=0;l<o;++l)W[s+l]=a[l];return i!==null&&i.push(B,f),f},argPackAdvance:8,readValueFromPointer:wr,destructorFunction:function(i){B(i)}})}function Ln(r,n){for(var e="",i=0;!(i>=n/2);++i){var a=Q[r+i*2>>1];if(a==0)break;e+=String.fromCharCode(a)}return e}function jn(r,n,e){if(e===void 0&&(e=2147483647),e<2)return 0;e-=2;for(var i=n,a=e<r.length*2?e/2:r.length,o=0;o<a;++o){var c=r.charCodeAt(o);Q[n>>1]=c,n+=2}return Q[n>>1]=0,n-i}function Bn(r){return r.length*2}function Nn(r,n){for(var e=0,i="";!(e>=n/4);){var a=X[r+e*4>>2];if(a==0)break;if(++e,a>=65536){var o=a-65536;i+=String.fromCharCode(55296|o>>10,56320|o&1023)}else i+=String.fromCharCode(a)}return i}function xn(r,n,e){if(e===void 0&&(e=2147483647),e<4)return 0;for(var i=n,a=i+e-4,o=0;o<r.length;++o){var c=r.charCodeAt(o);if(c>=55296&&c<=57343){var f=r.charCodeAt(++o);c=65536+((c&1023)<<10)|f&1023}if(X[n>>2]=c,n+=4,n+4>a)break}return X[n>>2]=0,n-i}function qn(r){for(var n=0,e=0;e<r.length;++e){var i=r.charCodeAt(e);i>=55296&&i<=57343&&++e,n+=4}return n}function zn(r,n,e){e=S(e);var i,a,o,c,f;n===2?(i=Ln,a=jn,c=Bn,o=()=>pr,f=1):n===4&&(i=Nn,a=xn,c=qn,o=()=>O,f=2),j(r,{name:e,fromWireType:function(s){for(var l=O[s>>2],b=o(),p,d=s+4,Z=0;Z<=l;++Z){var x=s+4+Z*n;if(Z==l||b[x>>f]==0){var ar=x-d,rr=i(d,ar);p===void 0?p=rr:(p+=String.fromCharCode(0),p+=rr),d=x+n}}return B(s),p},toWireType:function(s,l){typeof l!="string"&&U("Cannot pass non-string to C++ string type "+e);var b=c(l),p=Ar(4+b+n);return O[p>>2]=b>>f,a(l,p+4,b+n),s!==null&&s.push(B,p),p},argPackAdvance:8,readValueFromPointer:wr,destructorFunction:function(s){B(s)}})}function Xn(r,n){n=S(n),j(r,{isVoid:!0,name:n,argPackAdvance:0,fromWireType:function(){},toWireType:function(e,i){}})}function br(r,n){var e=Y[r];return e===void 0&&U(n+" has unknown type "+Gr(r)),e}function Gn(r,n,e){r=R.toValue(r),n=br(n,"emval::as");var i=[],a=R.toHandle(i);return O[e>>2]=a,n.toWireType(i,r)}function Yn(r,n){for(var e=new Array(r),i=0;i<r;++i)e[i]=br(O[n+i*K>>2],"parameter "+i);return e}function Zn(r,n,e,i){r=R.toValue(r);for(var a=Yn(n,e),o=new Array(n),c=0;c<n;++c){var f=a[c];o[c]=f.readValueFromPointer(i),i+=f.argPackAdvance}var s=r.apply(void 0,o);return R.toHandle(s)}function $n(r,n){return r=R.toValue(r),n=R.toValue(n),R.toHandle(r[n])}function Kn(r){r>4&&(V[r].refcount+=1)}function Jn(r){return r=R.toValue(r),typeof r=="number"}var Qn={};function Mn(r){var n=Qn[r];return n===void 0?S(r):n}function re(r){return R.toHandle(Mn(r))}function ne(r){var n=R.toValue(r);qr(n),yr(r)}function ee(r,n){r=br(r,"_emval_take_value");var e=r.readValueFromPointer(n);return R.toHandle(e)}function te(){ir("")}function ie(r,n,e){W.copyWithin(r,n,n+e)}function ae(){return 2147483648}function oe(r){try{return J.grow(r-er.byteLength+65535>>>16),Wr(J.buffer),1}catch(n){}}function fe(r){var n=W.length;r=r>>>0;var e=ae();if(r>e)return!1;let i=(s,l)=>s+(l-s%l)%l;for(var a=1;a<=4;a*=2){var o=n*(1+.2/a);o=Math.min(o,r+100663296);var c=Math.min(e,i(Math.max(r,o),65536)),f=oe(c);if(f)return!0}return!1}ln(),Br=t.BindingError=dr(Error,"BindingError"),Nr=t.InternalError=dr(Error,"InternalError"),mn(),Xr=t.UnboundTypeError=dr(Error,"UnboundTypeError");var se={a:cn,q:un,u:gn,t:yn,o:bn,h:In,d:Vn,c:Hn,n:Dn,l:zn,v:Xn,k:Gn,w:Zn,b:yr,e:$n,g:Kn,p:Jn,f:re,j:ne,i:ee,m:te,s:ie,r:fe},ye=sn(),ce=t.___wasm_call_ctors=function(){return(ce=t.___wasm_call_ctors=t.asm.y).apply(null,arguments)},Ar=t._malloc=function(){return(Ar=t._malloc=t.asm.z).apply(null,arguments)},B=t._free=function(){return(B=t._free=t.asm.A).apply(null,arguments)},Yr=t.___getTypeName=function(){return(Yr=t.___getTypeName=t.asm.C).apply(null,arguments)},ue=t.__embind_initialize_bindings=function(){return(ue=t.__embind_initialize_bindings=t.asm.D).apply(null,arguments)},le=t.dynCall_ijiii=function(){return(le=t.dynCall_ijiii=t.asm.E).apply(null,arguments)},ur;tr=function r(){ur||Zr(),ur||(tr=r)};function Zr(r){if(r=r||v,G>0||(Jr(),G>0))return;function n(){ur||(ur=!0,t.calledRun=!0,!fr&&(Qr(),u(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),Mr()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),n()},1)):n()}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return Zr(),t.ready}})(),pe=Er,Tr=new Uint8Array([0,0,0,1]);function he(g){console.error(g)}Er.createFile=Fr;function Fr(g=256){let t=0,u=0,h=new Uint8Array(g);return{contents:function(){return h.slice(0,u)},seek:function(v){t=v},write:function(v){let _=v.byteLength;return y(t+_),h.set(v,t),t+=_,u=Math.max(u,t),_}};function y(v){var _=h.length;if(_>=v)return;var N=1024*1024;v=Math.max(v,_*(_<N?2:1.125)>>>0),_!=0&&(v=Math.max(v,256));let D=h;h=new Uint8Array(v),u>0&&h.set(D.subarray(0,u),0)}}Er.isWebCodecsSupported=Cr;function Cr(){return typeof window!="undefined"&&typeof window.VideoEncoder=="function"}function $r(g,t={}){let{width:u,height:h,groupOfPictures:y=20,fps:v=30,fragmentation:_=!1,sequential:N=!1,hevc:D=!1,format:H="annexb",codec:or="avc1.4d0034",acceleration:A,bitrate:L,error:I=he,encoderOptions:q={},flushFrequency:$=10}=t;if(!Cr())throw new Error("MP4 H264 encoding/decoding depends on WebCodecs API which is not supported in this environment");if(typeof u!="number"||typeof h!="number")throw new Error("Must specify { width, height } options");if(!isFinite(u)||u<0||!isFinite(h)||h<0)throw new Error("{ width, height } options must be positive integers");let nr=Fr(),lr=g.create_muxer({width:u,height:h,fps:v,fragmentation:_,sequential:N,hevc:D},Ur),z={codec:or,width:u,height:h,avc:{format:H},hardwareAcceleration:A,bitrate:L,...q},K=0,P=new window.VideoEncoder({output(w,m){fr(w,m)},error:I});return P.configure(z),{async end(){return await P.flush(),P.close(),g.finalize_muxer(lr),nr.contents()},async addFrame(w,m){m=m||{};let T=1/v*K*1e6,{keyFrame:F}=m;F===void 0&&(F=y>0&&K%y==0);let C=new VideoFrame(w,{timestamp:T});P.encode(C,{keyFrame:F}),C.close(),$!=null&&(K+1)%$==0&&await P.flush(),K++},async flush(){return P.flush()}};function Ur(w,m,T){nr.seek(T);let F=g.HEAPU8.subarray(w,w+m);return nr.write(F)!==F.byteLength}function J(w){let m=g._malloc(w.byteLength);g.HEAPU8.set(w,m),g.mux_nal(lr,m,w.byteLength),g._free(m)}function fr(w,m){let T=null,F;if(m&&(m.description&&(F=m.description),m.decoderConfig&&m.decoderConfig.description&&(F=m.decoderConfig.description)),F)try{T=de(F)}catch(E){I(E);return}let C=[];if(T&&(T.sps_list.forEach(E=>{C.push(Tr),C.push(E)}),T.pps_list.forEach(E=>{C.push(Tr),C.push(E)})),H==="annexb"){let E=new Uint8Array(w.byteLength);w.copyTo(E),C.push(E)}else try{let E=new ArrayBuffer(w.byteLength);w.copyTo(E),_e(E).forEach(er=>{C.push(Tr),C.push(er)})}catch(E){I(E);return}J(ge(C))}}function ge(g){let t=g.reduce((y,v)=>y+v.byteLength,0),u=new Uint8Array(t),h=0;for(let y=0;y<g.length;y++){let v=g[y];u.set(v,h),h+=v.byteLength}return u}function _e(g){let t=4,u=0,h=[],y=g.byteLength,v=new Uint8Array(g);for(;u+t<y;){let _=v[u];if(_=(_<<8)+v[u+1],_=(_<<8)+v[u+2],_=(_<<8)+v[u+3],h.push(new Uint8Array(g,u+t,_)),_==0)throw new Error("Error: invalid nal_length 0");u+=t+_}return h}function de(g){let t=new DataView(g),u=0,h=t.getUint8(u++),y=t.getUint8(u++),v=t.getUint8(u++),_=t.getUint8(u++),N=(t.getUint8(u++)&3)+1;if(N!==4)throw new Error("Expected length_size to indicate 4 bytes");let D=t.getUint8(u++)&31,H=[];for(let L=0;L<D;L++){let I=t.getUint16(u,!1);u+=2;let q=new Uint8Array(t.buffer,u,I);H.push(q),u+=I}let or=t.getUint8(u++),A=[];for(let L=0;L<or;L++){let I=t.getUint16(u,!1);u+=2;let q=new Uint8Array(t.buffer,u,I);A.push(q),u+=I}return{offset:u,version:h,profile:y,compat:v,level:_,length_size:N,pps_list:A,sps_list:H,numSPS:D}}export{Fr as createFile,$r as createWebCodecsEncoderWithModule,pe as default,Cr as isWebCodecsSupported};
//# sourceMappingURL=mp4.js.map
