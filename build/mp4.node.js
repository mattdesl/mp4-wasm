var Qn=Object.defineProperty;var me=p=>Qn(p,"__esModule",{value:!0});var ye=(p,t)=>{for(var u in t)Qn(p,u,{get:t[u],enumerable:!0})};me(exports);ye(exports,{createFile:()=>Pn,createWebCodecsEncoderWithModule:()=>Mn,isWebCodecsSupported:()=>Rn});var sn=(()=>{var p=typeof document!="undefined"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename!="undefined"&&(p=p||__filename),function(t){t=t||{};var t=typeof t!="undefined"?t:{},u,h;t.ready=new Promise(function(n,r){u=n,h=r}),t.create_buffer=function(r){return t._malloc(r)},t.free_buffer=function(r){return t._free(r)},t.locateFile=function(r,e){return t.simd&&(r=r.replace(/\.wasm$/i,".simd.wasm")),t.getWasmPath?t.getWasmPath(r,e,t.simd):e+r},t.createWebCodecsEncoder=function(r){return Mn(t,r)};var w=Object.assign({},t),v=[],d="./this.program",H=(n,r)=>{throw r},B=!1,N=!1,K=!0,V="";function D(n){return t.locateFile?t.locateFile(n,V):V+n}var P,z,G;function rn(n){if(n instanceof jn)return;T("exiting due to exception: "+n)}if(K){N?V=require("path").dirname(V)+"/":V=__dirname+"/";var J,en;J=require("fs"),en=require("path"),P=(n,r)=>(n=en.normalize(n),J.readFileSync(n,r?void 0:"utf8")),G=n=>{var r=P(n,!0);return r.buffer||(r=new Uint8Array(r)),r},z=(n,r,e)=>{n=en.normalize(n),J.readFile(n,function(i,a){i?e(i):r(a.buffer)})},process.argv.length>1&&(d=process.argv[1].replace(/\\/g,"/")),v=process.argv.slice(2),process.on("uncaughtException",function(n){if(!(n instanceof jn))throw n}),process.on("unhandledRejection",function(n){throw n}),H=(n,r)=>{if(er())throw process.exitCode=n,r;rn(r),process.exit(n)},t.inspect=function(){return"[Emscripten Module object]"}}var tn=t.print||console.log.bind(console),T=t.printErr||console.warn.bind(console);Object.assign(t,w),w=null,t.arguments&&(v=t.arguments),t.thisProgram&&(d=t.thisProgram),t.quit&&(H=t.quit);var vn=4,q;t.wasmBinary&&(q=t.wasmBinary);var pn=t.noExitRuntime||!0;typeof WebAssembly!="object"&&on("no native wasm support detected");var y,m=!1,O;function F(n,r,e){for(var i=r+e,a="";!(r>=i);){var o=n[r++];if(!o)return a;if(!(o&128)){a+=String.fromCharCode(o);continue}var c=n[r++]&63;if((o&224)==192){a+=String.fromCharCode((o&31)<<6|c);continue}var f=n[r++]&63;if((o&240)==224?o=(o&15)<<12|c<<6|f:o=(o&7)<<18|c<<12|f<<6|n[r++]&63,o<65536)a+=String.fromCharCode(o);else{var s=o-65536;a+=String.fromCharCode(55296|s>>10,56320|s&1023)}}return a}function A(n,r){return n?F(R,n,r):""}function E(n,r,e,i){if(!(i>0))return 0;for(var a=e,o=e+i-1,c=0;c<n.length;++c){var f=n.charCodeAt(c);if(f>=55296&&f<=57343){var s=n.charCodeAt(++c);f=65536+((f&1023)<<10)|s&1023}if(f<=127){if(e>=o)break;r[e++]=f}else if(f<=2047){if(e+1>=o)break;r[e++]=192|f>>6,r[e++]=128|f&63}else if(f<=65535){if(e+2>=o)break;r[e++]=224|f>>12,r[e++]=128|f>>6&63,r[e++]=128|f&63}else{if(e+3>=o)break;r[e++]=240|f>>18,r[e++]=128|f>>12&63,r[e++]=128|f>>6&63,r[e++]=128|f&63}}return r[e]=0,e-a}function gn(n,r,e){return E(n,R,r,e)}function nr(n){for(var r=0,e=0;e<n.length;++e){var i=n.charCodeAt(e);i<=127?r++:i<=2047?r+=2:i>=55296&&i<=57343?(r+=4,++e):r+=3}return r}var hn,dn,R,Q,_n,Y,S,kn,Sn;function Wn(n){hn=n,t.HEAP8=dn=new Int8Array(n),t.HEAP16=Q=new Int16Array(n),t.HEAP32=Y=new Int32Array(n),t.HEAPU8=R=new Uint8Array(n),t.HEAPU16=_n=new Uint16Array(n),t.HEAPU32=S=new Uint32Array(n),t.HEAPF32=kn=new Float32Array(n),t.HEAPF64=Sn=new Float64Array(n)}var Te=t.INITIAL_MEMORY||16777216,In,Vn=[],On=[],Hn=[],rr=!1;function er(){return pn}function tr(){if(t.preRun)for(typeof t.preRun=="function"&&(t.preRun=[t.preRun]);t.preRun.length;)or(t.preRun.shift());yn(Vn)}function ir(){rr=!0,yn(On)}function ar(){if(t.postRun)for(typeof t.postRun=="function"&&(t.postRun=[t.postRun]);t.postRun.length;)sr(t.postRun.shift());yn(Hn)}function or(n){Vn.unshift(n)}function fr(n){On.unshift(n)}function sr(n){Hn.unshift(n)}var X=0,mn=null,an=null;function cr(n){X++,t.monitorRunDependencies&&t.monitorRunDependencies(X)}function ur(n){if(X--,t.monitorRunDependencies&&t.monitorRunDependencies(X),X==0&&(mn!==null&&(clearInterval(mn),mn=null),an)){var r=an;an=null,r()}}function on(n){t.onAbort&&t.onAbort(n),n="Aborted("+n+")",T(n),m=!0,O=1,n+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(n);throw h(r),r}var lr="data:application/octet-stream;base64,";function Dn(n){return n.startsWith(lr)}var W;W="mp4.node.wasm",Dn(W)||(W=D(W));function Ln(n){try{if(n==W&&q)return new Uint8Array(q);if(G)return G(n);throw"both async and sync fetching of the wasm failed"}catch(r){on(r)}}function vr(){return!q&&(B||N)&&typeof fetch=="function"?fetch(W,{credentials:"same-origin"}).then(function(n){if(!n.ok)throw"failed to load wasm binary file at '"+W+"'";return n.arrayBuffer()}).catch(function(){return Ln(W)}):Promise.resolve().then(function(){return Ln(W)})}function pr(){var n={a:pe};function r(c,f){var s=c.exports;t.asm=s,y=t.asm.x,Wn(y.buffer),In=t.asm.B,fr(t.asm.y),ur("wasm-instantiate")}cr("wasm-instantiate");function e(c){r(c.instance)}function i(c){return vr().then(function(f){return WebAssembly.instantiate(f,n)}).then(function(f){return f}).then(c,function(f){T("failed to asynchronously prepare wasm: "+f),on(f)})}function a(){return!q&&typeof WebAssembly.instantiateStreaming=="function"&&!Dn(W)&&!K&&typeof fetch=="function"?fetch(W,{credentials:"same-origin"}).then(function(c){var f=WebAssembly.instantiateStreaming(c,n);return f.then(e,function(s){return T("wasm streaming compile failed: "+s),T("falling back to ArrayBuffer instantiation"),i(e)})}):i(e)}if(t.instantiateWasm)try{var o=t.instantiateWasm(n,r);return o}catch(c){T("Module.instantiateWasm callback failed with error: "+c),h(c)}return a().catch(h),{}}function jn(n){this.name="ExitStatus",this.message="Program terminated with exit("+n+")",this.status=n}function yn(n){for(;n.length>0;)n.shift()(t)}function gr(n,r,e,i){on("Assertion failed: "+A(n)+", at: "+[r?A(r):"unknown filename",e,i?A(i):"unknown function"])}function hr(n,r,e,i,a){}function wn(n){switch(n){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+n)}}function dr(){for(var n=new Array(256),r=0;r<256;++r)n[r]=String.fromCharCode(r);Bn=n}var Bn=void 0;function k(n){for(var r="",e=n;R[e];)r+=Bn[R[e++]];return r}var M={},Z={},cn={},_r=48,mr=57;function Nn(n){if(n===void 0)return"_unknown";n=n.replace(/[^a-zA-Z0-9_]/g,"$");var r=n.charCodeAt(0);return r>=_r&&r<=mr?"_"+n:n}function xn(n,r){return n=Nn(n),new Function("body","return function "+n+`() {
    "use strict";    return body.apply(this, arguments);
};
`)(r)}function bn(n,r){var e=xn(r,function(i){this.name=r,this.message=i;var a=new Error(i).stack;a!==void 0&&(this.stack=this.toString()+`
`+a.replace(/^Error(:[^\n]*)?\n/,""))});return e.prototype=Object.create(n.prototype),e.prototype.constructor=e,e.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},e}var zn=void 0;function C(n){throw new zn(n)}var qn=void 0;function Yn(n){throw new qn(n)}function yr(n,r,e){n.forEach(function(f){cn[f]=r});function i(f){var s=e(f);s.length!==n.length&&Yn("Mismatched type converter count");for(var l=0;l<n.length;++l)L(n[l],s[l])}var a=new Array(r.length),o=[],c=0;r.forEach((f,s)=>{Z.hasOwnProperty(f)?a[s]=Z[f]:(o.push(f),M.hasOwnProperty(f)||(M[f]=[]),M[f].push(()=>{a[s]=Z[f],++c,c===o.length&&i(a)}))}),o.length===0&&i(a)}function L(n,r,e={}){if(!("argPackAdvance"in r))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=r.name;if(n||C('type "'+i+'" must have a positive integer typeid pointer'),Z.hasOwnProperty(n)){if(e.ignoreDuplicateRegistrations)return;C("Cannot register type '"+i+"' twice")}if(Z[n]=r,delete cn[n],M.hasOwnProperty(n)){var a=M[n];delete M[n],a.forEach(o=>o())}}function wr(n,r,e,i,a){var o=wn(e);r=k(r),L(n,{name:r,fromWireType:function(c){return!!c},toWireType:function(c,f){return f?i:a},argPackAdvance:8,readValueFromPointer:function(c){var f;if(e===1)f=dn;else if(e===2)f=Q;else if(e===4)f=Y;else throw new TypeError("Unknown boolean type size: "+r);return this.fromWireType(f[c>>o])},destructorFunction:null})}var An=[],I=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function En(n){n>4&&--I[n].refcount==0&&(I[n]=void 0,An.push(n))}function br(){for(var n=0,r=5;r<I.length;++r)I[r]!==void 0&&++n;return n}function Ar(){for(var n=5;n<I.length;++n)if(I[n]!==void 0)return I[n];return null}function Er(){t.count_emval_handles=br,t.get_first_emval=Ar}var U={toValue:n=>(n||C("Cannot use deleted val. handle = "+n),I[n].value),toHandle:n=>{switch(n){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:{var r=An.length?An.pop():I.length;return I[r]={refcount:1,value:n},r}}}};function Tn(n){return this.fromWireType(Y[n>>2])}function Tr(n,r){r=k(r),L(n,{name:r,fromWireType:function(e){var i=U.toValue(e);return En(e),i},toWireType:function(e,i){return U.toHandle(i)},argPackAdvance:8,readValueFromPointer:Tn,destructorFunction:null})}function Fr(n,r){switch(r){case 2:return function(e){return this.fromWireType(kn[e>>2])};case 3:return function(e){return this.fromWireType(Sn[e>>3])};default:throw new TypeError("Unknown float type: "+n)}}function Cr(n,r,e){var i=wn(e);r=k(r),L(n,{name:r,fromWireType:function(a){return a},toWireType:function(a,o){return o},argPackAdvance:8,readValueFromPointer:Fr(r,i),destructorFunction:null})}function Ur(n,r){if(!(n instanceof Function))throw new TypeError("new_ called with constructor type "+typeof n+" which is not a function");var e=xn(n.name||"unknownFunctionName",function(){});e.prototype=n.prototype;var i=new e,a=n.apply(i,r);return a instanceof Object?a:i}function Xn(n){for(;n.length;){var r=n.pop(),e=n.pop();e(r)}}function Pr(n,r,e,i,a){var o=r.length;o<2&&C("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var c=r[1]!==null&&e!==null,f=!1,s=1;s<r.length;++s)if(r[s]!==null&&r[s].destructorFunction===void 0){f=!0;break}for(var l=r[0].name!=="void",b="",g="",s=0;s<o-2;++s)b+=(s!==0?", ":"")+"arg"+s,g+=(s!==0?", ":"")+"arg"+s+"Wired";var _="return function "+Nn(n)+"("+b+`) {
if (arguments.length !== `+(o-2)+`) {
throwBindingError('function `+n+" called with ' + arguments.length + ' arguments, expected "+(o-2)+` args!');
}
`;f&&(_+=`var destructors = [];
`);var $=f?"destructors":"null",x=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],fn=[C,i,a,Xn,r[0],r[1]];c&&(_+="var thisWired = classParam.toWireType("+$+`, this);
`);for(var s=0;s<o-2;++s)_+="var arg"+s+"Wired = argType"+s+".toWireType("+$+", arg"+s+"); // "+r[s+2].name+`
`,x.push("argType"+s),fn.push(r[s+2]);if(c&&(g="thisWired"+(g.length>0?", ":"")+g),_+=(l?"var rv = ":"")+"invoker(fn"+(g.length>0?", ":"")+g+`);
`,f)_+=`runDestructors(destructors);
`;else for(var s=c?1:2;s<r.length;++s){var nn=s===1?"thisWired":"arg"+(s-2)+"Wired";r[s].destructorFunction!==null&&(_+=nn+"_dtor("+nn+"); // "+r[s].name+`
`,x.push(nn+"_dtor"),fn.push(r[s].destructorFunction))}l&&(_+=`var ret = retType.fromWireType(rv);
return ret;
`),_+=`}
`,x.push(_);var _e=Ur(Function,x).apply(null,fn);return _e}function Rr(n,r,e){if(n[r].overloadTable===void 0){var i=n[r];n[r]=function(){return n[r].overloadTable.hasOwnProperty(arguments.length)||C("Function '"+e+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+n[r].overloadTable+")!"),n[r].overloadTable[arguments.length].apply(this,arguments)},n[r].overloadTable=[],n[r].overloadTable[i.argCount]=i}}function kr(n,r,e){t.hasOwnProperty(n)?((e===void 0||t[n].overloadTable!==void 0&&t[n].overloadTable[e]!==void 0)&&C("Cannot register public name '"+n+"' twice"),Rr(t,n,n),t.hasOwnProperty(e)&&C("Cannot register multiple overloads of a function with the same number of arguments ("+e+")!"),t[n].overloadTable[e]=r):(t[n]=r,e!==void 0&&(t[n].numArguments=e))}function Sr(n,r){for(var e=[],i=0;i<n;i++)e.push(S[r+i*4>>2]);return e}function Wr(n,r,e){t.hasOwnProperty(n)||Yn("Replacing nonexistant public symbol"),t[n].overloadTable!==void 0&&e!==void 0?t[n].overloadTable[e]=r:(t[n]=r,t[n].argCount=e)}function Ir(n,r,e){var i=t["dynCall_"+n];return e&&e.length?i.apply(null,[r].concat(e)):i.call(null,r)}var un=[];function Zn(n){var r=un[n];return r||(n>=un.length&&(un.length=n+1),un[n]=r=In.get(n)),r}function Vr(n,r,e){if(n.includes("j"))return Ir(n,r,e);var i=Zn(r).apply(null,e);return i}function Or(n,r){var e=[];return function(){return e.length=0,Object.assign(e,arguments),Vr(n,r,e)}}function Hr(n,r){n=k(n);function e(){return n.includes("j")?Or(n,r):Zn(r)}var i=e();return typeof i!="function"&&C("unknown function pointer with signature "+n+": "+r),i}var $n=void 0;function Kn(n){var r=Gn(n),e=k(r);return j(r),e}function Dr(n,r){var e=[],i={};function a(o){if(!i[o]&&!Z[o]){if(cn[o]){cn[o].forEach(a);return}e.push(o),i[o]=!0}}throw r.forEach(a),new $n(n+": "+e.map(Kn).join([", "]))}function Lr(n,r,e,i,a,o){var c=Sr(r,e);n=k(n),a=Hr(i,a),kr(n,function(){Dr("Cannot call "+n+" due to unbound types",c)},r-1),yr([],c,function(f){var s=[f[0],null].concat(f.slice(1));return Wr(n,Pr(n,s,null,a,o),r-1),[]})}function jr(n,r,e){switch(r){case 0:return e?function(a){return dn[a]}:function(a){return R[a]};case 1:return e?function(a){return Q[a>>1]}:function(a){return _n[a>>1]};case 2:return e?function(a){return Y[a>>2]}:function(a){return S[a>>2]};default:throw new TypeError("Unknown integer type: "+n)}}function Br(n,r,e,i,a){r=k(r),a===-1&&(a=4294967295);var o=wn(e),c=g=>g;if(i===0){var f=32-8*e;c=g=>g<<f>>>f}var s=r.includes("unsigned"),l=(g,_)=>{},b;s?b=function(g,_){return l(_,this.name),_>>>0}:b=function(g,_){return l(_,this.name),_},L(n,{name:r,fromWireType:c,toWireType:b,argPackAdvance:8,readValueFromPointer:jr(r,o,i!==0),destructorFunction:null})}function Nr(n,r,e){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],a=i[r];function o(c){c=c>>2;var f=S,s=f[c],l=f[c+1];return new a(hn,l,s)}e=k(e),L(n,{name:e,fromWireType:o,argPackAdvance:8,readValueFromPointer:o},{ignoreDuplicateRegistrations:!0})}function xr(n,r){r=k(r);var e=r==="std::string";L(n,{name:r,fromWireType:function(i){var a=S[i>>2],o=i+4,c;if(e)for(var f=o,s=0;s<=a;++s){var l=o+s;if(s==a||R[l]==0){var b=l-f,g=A(f,b);c===void 0?c=g:(c+=String.fromCharCode(0),c+=g),f=l+1}}else{for(var _=new Array(a),s=0;s<a;++s)_[s]=String.fromCharCode(R[o+s]);c=_.join("")}return j(i),c},toWireType:function(i,a){a instanceof ArrayBuffer&&(a=new Uint8Array(a));var o,c=typeof a=="string";c||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Int8Array||C("Cannot pass non-string to std::string"),e&&c?o=nr(a):o=a.length;var f=Cn(4+o+1),s=f+4;if(S[f>>2]=o,e&&c)gn(a,s,o+1);else if(c)for(var l=0;l<o;++l){var b=a.charCodeAt(l);b>255&&(j(s),C("String has UTF-16 code units that do not fit in 8 bits")),R[s+l]=b}else for(var l=0;l<o;++l)R[s+l]=a[l];return i!==null&&i.push(j,f),f},argPackAdvance:8,readValueFromPointer:Tn,destructorFunction:function(i){j(i)}})}function zr(n,r){for(var e="",i=0;!(i>=r/2);++i){var a=Q[n+i*2>>1];if(a==0)break;e+=String.fromCharCode(a)}return e}function qr(n,r,e){if(e===void 0&&(e=2147483647),e<2)return 0;e-=2;for(var i=r,a=e<n.length*2?e/2:n.length,o=0;o<a;++o){var c=n.charCodeAt(o);Q[r>>1]=c,r+=2}return Q[r>>1]=0,r-i}function Yr(n){return n.length*2}function Xr(n,r){for(var e=0,i="";!(e>=r/4);){var a=Y[n+e*4>>2];if(a==0)break;if(++e,a>=65536){var o=a-65536;i+=String.fromCharCode(55296|o>>10,56320|o&1023)}else i+=String.fromCharCode(a)}return i}function Zr(n,r,e){if(e===void 0&&(e=2147483647),e<4)return 0;for(var i=r,a=i+e-4,o=0;o<n.length;++o){var c=n.charCodeAt(o);if(c>=55296&&c<=57343){var f=n.charCodeAt(++o);c=65536+((c&1023)<<10)|f&1023}if(Y[r>>2]=c,r+=4,r+4>a)break}return Y[r>>2]=0,r-i}function $r(n){for(var r=0,e=0;e<n.length;++e){var i=n.charCodeAt(e);i>=55296&&i<=57343&&++e,r+=4}return r}function Kr(n,r,e){e=k(e);var i,a,o,c,f;r===2?(i=zr,a=qr,c=Yr,o=()=>_n,f=1):r===4&&(i=Xr,a=Zr,c=$r,o=()=>S,f=2),L(n,{name:e,fromWireType:function(s){for(var l=S[s>>2],b=o(),g,_=s+4,$=0;$<=l;++$){var x=s+4+$*r;if($==l||b[x>>f]==0){var fn=x-_,nn=i(_,fn);g===void 0?g=nn:(g+=String.fromCharCode(0),g+=nn),_=x+r}}return j(s),g},toWireType:function(s,l){typeof l!="string"&&C("Cannot pass non-string to C++ string type "+e);var b=c(l),g=Cn(4+b+r);return S[g>>2]=b>>f,a(l,g+4,b+r),s!==null&&s.push(j,g),g},argPackAdvance:8,readValueFromPointer:Tn,destructorFunction:function(s){j(s)}})}function Gr(n,r){r=k(r),L(n,{isVoid:!0,name:r,argPackAdvance:0,fromWireType:function(){},toWireType:function(e,i){}})}function Fn(n,r){var e=Z[n];return e===void 0&&C(r+" has unknown type "+Kn(n)),e}function Jr(n,r,e){n=U.toValue(n),r=Fn(r,"emval::as");var i=[],a=U.toHandle(i);return S[e>>2]=a,r.toWireType(i,n)}function Qr(n,r){for(var e=new Array(n),i=0;i<n;++i)e[i]=Fn(S[r+i*vn>>2],"parameter "+i);return e}function Mr(n,r,e,i){n=U.toValue(n);for(var a=Qr(r,e),o=new Array(r),c=0;c<r;++c){var f=a[c];o[c]=f.readValueFromPointer(i),i+=f.argPackAdvance}var s=n.apply(void 0,o);return U.toHandle(s)}function ne(n,r){return n=U.toValue(n),r=U.toValue(r),U.toHandle(n[r])}function re(n){n>4&&(I[n].refcount+=1)}function ee(n){return n=U.toValue(n),typeof n=="number"}var te={};function ie(n){var r=te[n];return r===void 0?k(n):r}function ae(n){return U.toHandle(ie(n))}function oe(n){var r=U.toValue(n);Xn(r),En(n)}function fe(n,r){n=Fn(n,"_emval_take_value");var e=n.readValueFromPointer(r);return U.toHandle(e)}function se(){on("")}function ce(n,r,e){R.copyWithin(n,r,r+e)}function ue(){return 2147483648}function le(n){try{return y.grow(n-hn.byteLength+65535>>>16),Wn(y.buffer),1}catch(r){}}function ve(n){var r=R.length;n=n>>>0;var e=ue();if(n>e)return!1;let i=(s,l)=>s+(l-s%l)%l;for(var a=1;a<=4;a*=2){var o=r*(1+.2/a);o=Math.min(o,n+100663296);var c=Math.min(e,i(Math.max(n,o),65536)),f=le(c);if(f)return!0}return!1}dr(),zn=t.BindingError=bn(Error,"BindingError"),qn=t.InternalError=bn(Error,"InternalError"),Er(),$n=t.UnboundTypeError=bn(Error,"UnboundTypeError");var pe={a:gr,q:hr,u:wr,t:Tr,o:Cr,h:Lr,d:Br,c:Nr,n:xr,l:Kr,v:Gr,k:Jr,w:Mr,b:En,e:ne,g:re,p:ee,f:ae,j:oe,i:fe,m:se,s:ce,r:ve},Fe=pr(),ge=t.___wasm_call_ctors=function(){return(ge=t.___wasm_call_ctors=t.asm.y).apply(null,arguments)},Cn=t._malloc=function(){return(Cn=t._malloc=t.asm.z).apply(null,arguments)},j=t._free=function(){return(j=t._free=t.asm.A).apply(null,arguments)},Gn=t.___getTypeName=function(){return(Gn=t.___getTypeName=t.asm.C).apply(null,arguments)},he=t.__embind_initialize_bindings=function(){return(he=t.__embind_initialize_bindings=t.asm.D).apply(null,arguments)},de=t.dynCall_ijiii=function(){return(de=t.dynCall_ijiii=t.asm.E).apply(null,arguments)},ln;an=function n(){ln||Jn(),ln||(an=n)};function Jn(n){if(n=n||v,X>0||(tr(),X>0))return;function r(){ln||(ln=!0,t.calledRun=!0,!m&&(ir(),u(t),t.onRuntimeInitialized&&t.onRuntimeInitialized(),ar()))}t.setStatus?(t.setStatus("Running..."),setTimeout(function(){setTimeout(function(){t.setStatus("")},1),r()},1)):r()}if(t.preInit)for(typeof t.preInit=="function"&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return Jn(),t.ready}})();typeof exports=="object"&&typeof module=="object"?module.exports=sn:typeof define=="function"&&define.amd?define([],function(){return sn}):typeof exports=="object"&&(exports.Module=sn);var Un=new Uint8Array([0,0,0,1]);function we(p){console.error(p)}sn.createFile=Pn;function Pn(p=256){let t=0,u=0,h=new Uint8Array(p);return{contents:function(){return h.slice(0,u)},seek:function(v){t=v},write:function(v){let d=v.byteLength;return w(t+d),h.set(v,t),t+=d,u=Math.max(u,t),d}};function w(v){var d=h.length;if(d>=v)return;var H=1024*1024;v=Math.max(v,d*(d<H?2:1.125)>>>0),d!=0&&(v=Math.max(v,256));let B=h;h=new Uint8Array(v),u>0&&h.set(B.subarray(0,u),0)}}sn.isWebCodecsSupported=Rn;function Rn(){return typeof window!="undefined"&&typeof window.VideoEncoder=="function"}function Mn(p,t={}){let{width:u,height:h,groupOfPictures:w=20,fps:v=30,fragmentation:d=!1,sequential:H=!1,hevc:B=!1,format:N="annexb",codec:K="avc1.4d0034",acceleration:V,bitrate:D,error:P=we,encoderOptions:z={},flushFrequency:G=10}=t;if(!Rn())throw new Error("MP4 H264 encoding/decoding depends on WebCodecs API which is not supported in this environment");if(typeof u!="number"||typeof h!="number")throw new Error("Must specify { width, height } options");if(!isFinite(u)||u<0||!isFinite(h)||h<0)throw new Error("{ width, height } options must be positive integers");let rn=Pn(),J=p.create_muxer({width:u,height:h,fps:v,fragmentation:d,sequential:H,hevc:B},vn),en={codec:K,width:u,height:h,avc:{format:N},hardwareAcceleration:V,bitrate:D,...z},tn=0,T=new window.VideoEncoder({output(y,m){pn(y,m)},error:P});return T.configure(en),{async end(){return await T.flush(),T.close(),p.finalize_muxer(J),rn.contents()},async addFrame(y,m){m=m||{};let O=1/v*tn*1e6,{keyFrame:F}=m;F===void 0&&(F=w>0&&tn%w==0);let A=new VideoFrame(y,{timestamp:O});T.encode(A,{keyFrame:F}),A.close(),G!=null&&(tn+1)%G==0&&await T.flush(),tn++},async flush(){return T.flush()}};function vn(y,m,O){rn.seek(O);let F=p.HEAPU8.subarray(y,y+m);return rn.write(F)!==F.byteLength}function q(y){let m=p._malloc(y.byteLength);p.HEAPU8.set(y,m),p.mux_nal(J,m,y.byteLength),p._free(m)}function pn(y,m){let O=null,F;if(m&&(m.description&&(F=m.description),m.decoderConfig&&m.decoderConfig.description&&(F=m.decoderConfig.description)),F)try{O=Ee(F)}catch(E){P(E);return}let A=[];if(O&&(O.sps_list.forEach(E=>{A.push(Un),A.push(E)}),O.pps_list.forEach(E=>{A.push(Un),A.push(E)})),N==="annexb"){let E=new Uint8Array(y.byteLength);y.copyTo(E),A.push(E)}else try{let E=new ArrayBuffer(y.byteLength);y.copyTo(E),Ae(E).forEach(gn=>{A.push(Un),A.push(gn)})}catch(E){P(E);return}q(be(A))}}function be(p){let t=p.reduce((w,v)=>w+v.byteLength,0),u=new Uint8Array(t),h=0;for(let w=0;w<p.length;w++){let v=p[w];u.set(v,h),h+=v.byteLength}return u}function Ae(p){let t=4,u=0,h=[],w=p.byteLength,v=new Uint8Array(p);for(;u+t<w;){let d=v[u];if(d=(d<<8)+v[u+1],d=(d<<8)+v[u+2],d=(d<<8)+v[u+3],h.push(new Uint8Array(p,u+t,d)),d==0)throw new Error("Error: invalid nal_length 0");u+=t+d}return h}function Ee(p){let t=new DataView(p),u=0,h=t.getUint8(u++),w=t.getUint8(u++),v=t.getUint8(u++),d=t.getUint8(u++),H=(t.getUint8(u++)&3)+1;if(H!==4)throw new Error("Expected length_size to indicate 4 bytes");let B=t.getUint8(u++)&31,N=[];for(let D=0;D<B;D++){let P=t.getUint16(u,!1);u+=2;let z=new Uint8Array(t.buffer,u,P);N.push(z),u+=P}let K=t.getUint8(u++),V=[];for(let D=0;D<K;D++){let P=t.getUint16(u,!1);u+=2;let z=new Uint8Array(t.buffer,u,P);V.push(z),u+=P}return{offset:u,version:h,profile:w,compat:v,level:d,length_size:H,pps_list:V,sps_list:N,numSPS:B}}
//# sourceMappingURL=mp4.node.js.map
